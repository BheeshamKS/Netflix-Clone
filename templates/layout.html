<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Netflix</title>
        <link href="static\styles.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    </head>
    <body>

        <nav class="navbar">
            <div class="nav-left">
                <img href="/" src="/static/images/netflix_logo.svg" alt="Logo" class="nav-logo">
                
                <ul class="nav-links">
                    <li>
                        <a href="/" class="{{ 'active' if request.endpoint == 'index' else '' }}">Home</a>
                    </li>

                    <li>
                        <a href="{{ url_for('tv_shows') }}" class="{{ 'active' if request.endpoint == 'tv_shows' else '' }}">TV Shows</a>
                    </li>

                    <li>
                        <a href="{{ url_for('movies') }}" class="{{ 'active' if request.endpoint == 'movies' else '' }}">Movies</a>
                    </li>

                    <li>
                        <a href="{{ url_for('new_popular') }}" class="{{ 'active' if request.endpoint == 'new_popular' else '' }}">New & Popular</a>
                    </li>

                    <li>
                        <a href="{{ url_for('my_list') }}" class="{{ 'active' if request.endpoint == 'my_list' else '' }}">My List</a>
                    </li>
                </ul>
            </div>

            <div class="nav-right">
                <div class="search-box" id="searchBox">
                    <i class="fas fa-search search-icon" onclick="toggleSearch()"></i>

                    <input type="text" 
                           id="searchInput" 
                           class="search-input"
                           placeholder="Titles, people, genres" 
                           autocomplete="off"
                           oninput="handleSearch(this.value)">

                    <i class="fas fa-times search-clear" 
                       id="searchClear" 
                       onclick="closeSearch()" 
                       style="display: none;"></i>
                </div>

                <div id="searchOverlay" class="search-overlay">
                    <div class="search-content">
                        <h3 id="resultsTitle" class="results-header"></h3>
                        <div class="search-grid" id="searchGrid">
                            </div>
                    </div>
                </div>

                {% if current_user.is_authenticated %}
                    <i class="fas fa-bell nav-icon"></i>
                    <div class="profile-menu" onclick="toggleProfileMenu()">
    
                        {% if active_profile %}
                            <div class="avatar-wrapper nav-size avatar-{{ active_profile.avatar }}">
                                <img src="{{ url_for('static', filename='images/user_avatar.png') }}" alt="User">
                            </div>
                        {% else %}
                            <div class="avatar-wrapper nav-size">
                                <img src="{{ url_for('static', filename='images/user_avatar.png') }}" alt="User">
                            </div>
                        {% endif %}

                        <i class="fas fa-caret-down profile-arrow"></i>
                    
                        <div class="dropdown-content" id="profileDropdown">

                            {% for profile in all_profiles %}
                            <a href="{{ url_for('set_profile', profile_id=profile.id) }}" class="dropdown-item profile-dropdown-item">

                                <div class="avatar-wrapper nav-size avatar-{{ profile.avatar }}">
                                    <img src="{{ url_for('static', filename='images/user_avatar.png') }}" alt="Smile">
                                </div>

                                <span>{{ profile.name }}</span>
                            </a>
                            {% endfor %}
                        
                            <a href="{{ url_for('manage_profiles') }}" class="dropdown-link text-link">Manage Profiles</a>

                            <div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-link text-link">Account</a>
                            <a href="#" class="dropdown-link text-link">Help Center</a>

                            <a href="{{ url_for('logout') }}" class="dropdown-link sign-out-link text-link">Sign out of Netflix</a>
                        </div>
                    </div>
                {% else %}
                    <a href="{{ url_for('login') }}" class="btn-play" style="width: 100px; height: 35px; font-size: 14px; text-decoration: none;">Sign In</a>
                {% endif %}
            </div>
        </nav> 
        <div id="searchResults" class="search-results-container">
            <div class="search-grid" id="searchGrid">
                </div>
        </div>

        <main>
            {% block main %}{% endblock %}
        </main>

        <script>
            let searchDebounce;

            // 1. OPEN SEARCH BOX
            function toggleSearch() {
                const box = document.getElementById('searchBox');
                const input = document.getElementById('searchInput');
                const clearBtn = document.getElementById('searchClear');
                        
                box.classList.toggle('active');
                        
                if (box.classList.contains('active')) {
                    input.focus();
                    // Hide X initially because box is empty
                    clearBtn.style.display = 'none'; 
                } else {
                    // If closing via icon click, clear everything
                    closeSearch();
                }
            }
        
            // 2. CLOSE SEARCH (X Button)
            function closeSearch() {
                const box = document.getElementById('searchBox');
                const input = document.getElementById('searchInput');
                const overlay = document.getElementById('searchOverlay');
                const clearBtn = document.getElementById('searchClear');

                // Reset everything
                input.value = '';            
                box.classList.remove('active'); 
                overlay.style.display = 'none'; 
                clearBtn.style.display = 'none'; // FORCE HIDE
            }
        
            // 3. HANDLE TYPING (The Logic)
            function handleSearch(query) {
                const overlay = document.getElementById('searchOverlay');
                const grid = document.getElementById('searchGrid');
                const title = document.getElementById('resultsTitle');
                const clearBtn = document.getElementById('searchClear');

                if (query.length > 0) {
                    clearBtn.style.display = 'block';
                } else {
                    clearBtn.style.display = 'none';
                }
            
                // Show/Hide X button
                clearBtn.style.display = query.length > 0 ? 'block' : 'none';
            
                // Clear previous timer
                clearTimeout(searchDebounce);
            
                // If empty, hide overlay and return
                if (!query.trim()) {
                    overlay.style.display = 'none';
                    return;
                }
            
                // 500ms Delay (Debounce)
                searchDebounce = setTimeout(() => {
                    fetch(`/search?q=${query}`)
                        .then(res => res.json())
                        .then(movies => {
                            grid.innerHTML = ''; // Clear old results
                            overlay.style.display = 'block'; // Show overlay

                            if (movies.length > 0) {
                                title.innerText = `More Titles Related to "${query}"`;

                                movies.forEach(movie => {
                                    const html = `
                                        <div class="movie-card" onclick="openMoreInfo('${movie.media_type}', ${movie.id})">
                                            <img src="https://image.tmdb.org/t/p/w500${movie.backdrop_path}" 
                                                 onerror="this.src='/static/images/placeholder.jpg'">

                                            <div class="card-overlay">
                                                <p class="movie-title">${movie.title}</p>
                                            </div>
                                        </div>
                                    `;
                                    grid.innerHTML += html;
                                });
                            } else {
                                title.innerText = `Your search for "${query}" did not have any matches.`;
                                grid.innerHTML = '<p style="color: grey;">Suggestions:<ul><li>Try different keywords</li><li>Looking for a movie or TV show?</li></ul></p>';
                            }
                        });
                }, 500);
            }
        
            // Optional: Close if user clicks outside
            document.addEventListener('click', function(event) {
                const box = document.getElementById('searchBox');
                const isClickInside = box.contains(event.target);
                const input = document.getElementById('searchInput');

                // If clicked outside AND input is empty, close it
                if (!isClickInside && input.value === '') {
                    box.classList.remove('active');
                }
            });
        </script>

        <footer class="site-footer">
            <div class="footer-content">

                <div class="footer-social">
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-youtube"></i></a>
                </div>
            
                <div class="footer-links">
                    <div class="footer-column">
                        <a href="#">Audio and Subtitles</a>
                        <a href="#">Media Centre</a>
                        <a href="#">Privacy</a>
                        <a href="#">Contact Us</a>
                    </div>
                
                    <div class="footer-column">
                        <a href="#">Audio Description</a>
                        <a href="#">Investor Relations</a>
                        <a href="#">Legal Notices</a>
                    </div>
                
                    <div class="footer-column">
                        <a href="#">Help Centre</a>
                        <a href="#">Jobs</a>
                        <a href="#">Cookie Preferences</a>
                    </div>
                
                    <div class="footer-column">
                        <a href="#">Gift Cards</a>
                        <a href="#">Terms of Use</a>
                        <a href="#">Corporate Information</a>
                    </div>
                </div>
            
                <button class="service-code-btn">Service Code</button>

                <div class="copyright-text">
                    &copy; 2026 Netflix Clone, Inc.
                </div>
            </div>
        </footer>

        <div id="video-modal" class="video-modal">
            <div class="video-container" id="video-container">
    
                <div class="video-header">
                    <h2 id="player-title">Movie Title</h2>
                </div>
            
                <div class="close-video-btn" onclick="closeVideo()">
                    <i class="fas fa-times"></i>
                </div>
            
                <div id="click-shield" onclick="togglePlay()">
                    <i class="fas fa-play big-play-icon"></i>
                </div>

                <div id="loading-spinner" class="loading-spinner"></div>
                
                <div id="youtube-player"></div>
            
                <div class="custom-controls" id="custom-controls">
                    <button class="control-btn" id="play-pause-btn" onclick="togglePlay()">
                        <i class="fas fa-pause"></i>
                    </button>
                
                    <div class="progress-container" onclick="seekVideo(event)">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                
                    <button class="control-btn" id="mute-btn" onclick="toggleMute()">
                        <i class="fas fa-volume-up"></i>
                    </button>

                    <button class="control-btn" onclick="toggleFullscreen()">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>
        </div>

        <div id="info-modal" class="info-modal">
            <div class="info-content">
                
                <div class="close-info-btn" onclick="closeMoreInfo()">
                    <i class="fas fa-times"></i>
                </div>
            
                <div class="info-header">
                    <img id="info-backdrop" src="" alt="">

                    <div class="info-header-overlay">
                        <h1 id="info-title">Movie Title</h1>

                        <div class="info-buttons">

                            <button id="info-play-btn" class="btn btn-play" onclick="">
                                <span class="play-icon">â–¶</span> Play
                            </button>
                        
                            <button id="info-list-btn" class="btn btn-list">
                                <i class="fas fa-plus"></i> My List
                            </button>

                        </div>
                    </div>
                </div>
            
                <div class="info-grid">
                    
                    <div class="info-left">
                        <div class="info-meta">
                            <span id="info-match" class="match-score">98% Match</span>
                            <span id="info-year">2024</span>
                            <span id="info-age" class="age-box">12+</span>
                            <span id="info-runtime">2h 15m</span>
                        </div>
                        <p id="info-overview">Description goes here...</p>
                    </div>
                
                    <div class="info-right">
                        <div class="info-row">
                            <span class="label">Cast:</span>
                            <span id="info-cast" class="value">Actor 1, Actor 2</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Genres:</span>
                            <span id="info-genres" class="value">Action, Sci-Fi</span>
                        </div>
                    </div>
                
                </div>
            </div>
        </div>

        <script src="https://www.youtube.com/iframe_api"></script>

        <script src="/static/script.js"></script>

        <script>
            function toggleProfileMenu() {
                // 1. Toggle the dropdown visibility
                document.getElementById("profileDropdown").classList.toggle("show");

                // 2. Rotate the arrow
                document.querySelector(".profile-menu").classList.toggle("open");
            }
        
            // Close the dropdown if the user clicks outside of it
            window.onclick = function(event) {
                if (!event.target.closest('.profile-menu')) {
                    var dropdowns = document.getElementsByClassName("dropdown-content");
                    var arrows = document.getElementsByClassName("profile-menu");

                    for (var i = 0; i < dropdowns.length; i++) {
                        var openDropdown = dropdowns[i];
                        if (openDropdown.classList.contains('show')) {
                            openDropdown.classList.remove('show');
                        }
                    }

                    // Reset arrow rotation
                    for (var i = 0; i < arrows.length; i++) {
                        arrows[i].classList.remove('open');
                    }
                }
            }
        </script>
    </body>
</html>